html_code = r"""<!DOCTYPE html>
<html lang=\"fa\">
<head>
<meta charset=\"UTF-8\" />
<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />
<title>نقاشی با حرکت دست</title>
<style>
  body {
    background-color: #111;
    color: white;
    font-family: sans-serif;
    text-align: center;
    margin: 0;
    overflow: hidden;
  }
  #controls {
    padding: 10px;
    background: #222;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }
  input[type=color], input[type=range], button {
    padding: 5px;
    border-radius: 5px;
    border: none;
    font-size: 16px;
  }
  canvas {
    position: absolute;
    left: 0;
    top: 0;
  }
  video {
    display: none;
  }
</style>
<script src=\"https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js\"></script>
<script src=\"https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js\"></script>
<script src=\"https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js\"></script>
</head>
<body>
<div id=\"controls\">
  رنگ قلم: <input type=\"color\" id=\"colorPicker\" value=\"#00ff00\" />
  ضخامت قلم: <input type=\"range\" id=\"thickness\" min=\"1\" max=\"30\" value=\"8\" />
  <button id=\"eraser\">پاک‌کن</button>
  <button id=\"clear\">پاک کردن همه</button>
  <button id=\"save\">ذخیره PNG</button>
  <button id=\"switchCam\">تغییر دوربین</button>
</div>
<video id=\"video\" playsinline></video>
<canvas id=\"drawCanvas\"></canvas>
<script>
let drawCanvas = document.getElementById('drawCanvas');
let ctx = drawCanvas.getContext('2d');
let videoElement = document.getElementById('video');
let colorPicker = document.getElementById('colorPicker');
let thickness = document.getElementById('thickness');
let eraserBtn = document.getElementById('eraser');
let clearBtn = document.getElementById('clear');
let saveBtn = document.getElementById('save');
let switchCamBtn = document.getElementById('switchCam');

let drawing = false;
let lastX, lastY;
let penColor = colorPicker.value;
let penSize = parseInt(thickness.value);
let erasing = false;
let facingMode = 'user'; // start with front camera

function resizeCanvas() {
  drawCanvas.width = window.innerWidth;
  drawCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

colorPicker.oninput = () => {
  penColor = colorPicker.value;
  erasing = false;
};
thickness.oninput = () => {
  penSize = parseInt(thickness.value);
};
eraserBtn.onclick = () => {
  erasing = !erasing;
};
clearBtn.onclick = () => {
  ctx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
};
saveBtn.onclick = () => {
  let link = document.createElement('a');
  link.download = 'drawing.png';
  link.href = drawCanvas.toDataURL('image/png');
  link.click();
};
switchCamBtn.onclick = () => {
  facingMode = (facingMode === 'user') ? 'environment' : 'user';
  startCamera();
};

function startCamera() {
  if (window.camera) {
    window.camera.stop();
  }
  const camera = new Camera(videoElement, {
    onFrame: async () => {
      await hands.send({ image: videoElement });
    },
    width: 640,
    height: 480,
    facingMode: facingMode
  });
  window.camera = camera;
  camera.start().catch(err => {
    alert('خطای دسترسی به دوربین: ' + err.message);
  });
}

const hands = new Hands({ locateFile: (file) => {
  return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
}});
hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(results => {
  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    const landmarks = results.multiHandLandmarks[0];
    const x = landmarks[8].x * drawCanvas.width; // index fingertip
    const y = landmarks[8].y * drawCanvas.height;
    const thumbDist = Math.hypot(
      (landmarks[4].x - landmarks[8].x) * drawCanvas.width,
      (landmarks[4].y - landmarks[8].y) * drawCanvas.height
    );
    // pinch < 40px => drawing mode
    if (thumbDist < 40) {
      if (!drawing) {
        drawing = true;
        lastX = x;
        lastY = y;
      }
      ctx.strokeStyle = erasing ? 'rgba(0,0,0,0)' : penColor;
      ctx.lineWidth = penSize;
      ctx.lineJoin = 'round';
      ctx.lineCap = 'round';
      ctx.globalCompositeOperation = erasing ? 'destination-out' : 'source-over';

      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.stroke();

      lastX = x;
      lastY = y;
    } else {
      drawing = false;
    }
  } else {
    drawing = false;
  }
});

startCamera();
</script>
</body>
</html>"""

with open("/mnt/data/index_fixed.html", "w", encoding="utf-8") as f:
    f.write(html_code)

"/mnt/data/index_fixed.html"
